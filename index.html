<!DOCTYPE html>
<html lang="en" dir="ltr" data-bs-theme="system">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Simple, beautiful, and user-friendly HTML template for Marzban subscription page."
    />
    <meta name="theme-color" content="#fff" />
    <title>{{ user.username }} - Sub Info</title>
    <script>
      // Color mode toggler.

      const COLOR_SCHEME = "(prefers-color-scheme: dark)";

      // Defines the default website theme used when the user hasn't
      // selected a different one.
      const DEFAULT_THEME = "system";
      // Colors for light and dark themes in the theme-color value,
      // used to change browser interface colors, like the top bar in Safari.
      const META_THEME_COLORS = { light: "#fff", dark: "#151515" };

      function getUserTheme() {
        return localStorage.getItem("theme") || DEFAULT_THEME;
      }

      function setTheme(theme) {
        if (theme === "system") {
          theme = window.matchMedia(COLOR_SCHEME).matches ? "dark" : "light";
        }
        document.documentElement.setAttribute("data-bs-theme", theme);
        document
          .querySelector(`[name='theme-color']`)
          .setAttribute("content", META_THEME_COLORS[theme]);
      }

      setTheme(getUserTheme());
      window.matchMedia(COLOR_SCHEME).addEventListener("change", () => {
        if (getUserTheme() === "system") setTheme("system");
      });

      document.addEventListener("DOMContentLoaded", () => {
        const btnTheme = document.getElementById("btn-theme");
        document.querySelectorAll(".my-dropdown-item-theme").forEach((item) => {
          item.addEventListener("click", () => {
            localStorage.setItem("theme", item.dataset.themeVal);
            setTheme(item.dataset.themeVal);
            showActiveDropdownItem(
              btnTheme,
              item,
              document.querySelector(".my-dropdown-item-theme.active")
            );
          });
        });

        showActiveDropdownItem(
          btnTheme,
          document.querySelector(`[data-theme-val="${getUserTheme()}"]`),
          document.querySelector(".my-dropdown-item-theme.active")
        );
      });
    </script>
    <link
      href="https://raw.githubusercontent.com/dermv/marzbanify-template/refs/heads/main/img/apple-touch-icon.png"
      rel="apple-touch-icon"
      sizes="180x180"
    />
    <link
      href="https://raw.githubusercontent.com/dermv/marzbanify-template/refs/heads/main/img/favicon-16x16.png"
      rel="icon"
      sizes="16x16"
      type="image/png"
    />
    <link
      href="https://raw.githubusercontent.com/dermv/marzbanify-template/refs/heads/main/img/favicon-32x32.png"
      rel="icon"
      sizes="32x32"
      type="image/png"
    />
    <link
      rel="stylesheet"
      id="dynamic-stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap");

      :root {
        --bs-body-font-family: "Inter", sans-serif;
      }

      [data-bs-theme="light"] {
        --bs-body-bg: #fff;

        --my-gray-color: #f6f5f4;
        --my-dark-gray-color: #eaeaea;
        --my-alpha-gray-color: rgba(50, 50, 50, 0.75);
        --my-alpha-dark-gray-color: rgba(0, 0, 0, 0.15);
        --my-emphasis-focus-shadow-rgb: 0, 0, 0;

        --my-heading-color: rgb(30, 25, 20);
        --my-content-color: rgba(0, 0, 0, 0.65);
        --my-dropdown-bg: #fff;
        --my-dropdown-link-hover-bg: rgba(55, 53, 47, 0.05);
        --my-modal-bg: #fff;
      }

      /* Добавляем специальные стили для светлой темы */
      [data-bs-theme="light"] .input-group {
        --bs-secondary-bg: #f8f8f8;
        background-color: #f8f8f8;
      }

      [data-bs-theme="light"] .input-group .form-control {
        background-color: #f8f8f8;
        color: #333;
      }

      [data-bs-theme="light"] .btn-copy-server,
      [data-bs-theme="light"] .my-btn-secondary {
        background-color: #e9ecef;
        color: #333;
      }

      [data-bs-theme="light"] .btn-copy-server:hover,
      [data-bs-theme="light"] .my-btn-secondary:hover {
        background-color: #dee2e6;
      }

      [data-bs-theme="light"] .btn-copy-server i,
      [data-bs-theme="light"] .my-btn-secondary svg {
        color: #333;
        fill: #333;
      }

      [data-bs-theme="light"] .text-bg-dark {
        background-color: #f8f8f8 !important;
        color: #333 !important;
      }

      [data-bs-theme="light"] .my-block-big {
        background-color: #f6f5f4;
      }

      [data-bs-theme="dark"] {
        --bs-body-bg: #151515;

        --my-gray-color: #232323;
        --my-dark-gray-color: #1c1c1c;
        --my-alpha-gray-color: rgba(255, 255, 255, 0.5);
        --my-alpha-dark-gray-color: rgba(255, 255, 255, 0.15);
        --my-emphasis-focus-shadow-rgb: 255, 255, 255;

        --my-heading-color: rgb(225, 225, 225);
        --my-content-color: rgba(255, 255, 255, 0.55);
        --my-dropdown-bg: #2c2c2c;
        --my-dropdown-link-hover-bg: rgba(255, 255, 255, 0.05);
        --my-modal-bg: #232323;
      }

      /* Добавляем улучшенные стили для темной темы */
      [data-bs-theme="dark"] .input-group {
        --bs-secondary-bg: #282a36;
        background-color: #282a36;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 1rem;
      }

      [data-bs-theme="dark"] .input-group .form-control {
        background-color: #282a36;
        color: #e9ecef;
        border: none;
        padding-left: 1rem;
      }

      [data-bs-theme="dark"] .btn-copy-server {
        background-color: #2a2d3d;
        color: #8be9fd;
        border: none;
        transition: all 0.2s ease;
      }

      [data-bs-theme="dark"] .my-btn-secondary {
        background-color: #2a2d3d;
        color: #8be9fd;
        border: none;
        transition: all 0.2s ease;
      }

      [data-bs-theme="dark"] .btn-copy-server:hover,
      [data-bs-theme="dark"] .my-btn-secondary:hover {
        background-color: #3a3f55;
        transform: translateY(-2px);
      }

      [data-bs-theme="dark"] .btn-copy-server i {
        color: #8be9fd;
      }

      [data-bs-theme="dark"] .my-btn-secondary svg {
        fill: #8be9fd;
      }

      [data-bs-theme="dark"] .text-bg-dark {
        background-color: #282a36 !important;
        color: #e9ecef !important;
      }

      [data-bs-theme="dark"] .my-block-big {
        background-color: #232323;
        border: 1px solid #2a2d3d;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .bi {
        fill: currentColor;
        width: 1em;
        height: 1em;
      }

      .dropdown-toggle::after {
        mask: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cpath d='M8.7 13.7c.4-.4 1.1-.4 1.5 0l6 6 6-6c.4-.4 1.1-.4 1.5 0s.4 1.1 0 1.5L17 21.9c-.4.4-1.1.4-1.5 0l-6.7-6.7c-.5-.6-.5-1.1-.1-1.5'/%3E%3C/svg%3E")
          50% 50% / cover no-repeat;
        float: right;
        width: 1em;
        height: 1.25em;
        margin-inline-end: -3px;
        margin-inline-start: 3px;
        background-color: currentColor;
      }

      .modal-backdrop {
        --bs-backdrop-opacity: 0.75;
      }

      .ms-auto {
        margin-left: 0 !important;
        margin-inline-start: auto !important;
      }

      .my-container {
        max-width: 1024px;
      }

      .my-navbar {
        --bs-navbar-nav-link-padding-x: 0.75rem;
      }

      .my-navbar .navbar-toggler {
        --bs-navbar-toggler-border-color: transparent;
        --bs-navbar-toggler-padding-x: 0;
        --bs-navbar-toggler-padding-y: 0;
      }

      @media (max-width: 576px) {
        .my-navbar .navbar-nav {
          --bs-nav-link-padding-y: 0.75rem;
        }

        .my-navbar .nav-item .nav-link {
          border-top: 1px solid var(--my-alpha-dark-gray-color);
        }

        .my-navbar .dropdown-menu {
          margin-bottom: 1rem;
        }
      }

      .my-nav-link,
      .my-nav-outline {
        display: flex;
        align-items: center;
      }

      .my-nav-link:focus-visible,
      .my-nav-outline:focus-visible {
        border-radius: var(--bs-border-radius-lg);
        box-shadow: 0 0 0 0.25rem var(--my-alpha-gray-color);
      }

      .my-nav-link .bi,
      .my-nav-outline .bi {
        margin-inline-end: 0.5rem;
        font-size: 1.25rem;
      }

      .my-nav-link-text {
        margin-inline-end: auto;
      }

      .my-nav-outline {
        --bs-nav-link-padding-x: 0.85rem;
        --bs-nav-link-padding-y: 0.25rem;
        --bs-nav-link-color: var(--my-heading-color);
        --bs-nav-link-hover-color: var(--my-heading-color);
        border: 1px solid var(--my-alpha-dark-gray-color);
        border-radius: var(--bs-border-radius-lg);
      }

      .my-nav-outline:hover {
        background-color: var(--my-gray-color);
      }

      .my-nav-outline.show {
        background-color: var(--my-gray-color);
      }

      .my-dropdown .dropdown-menu {
        --bs-dropdown-padding-x: 0.25rem;
        --bs-dropdown-padding-y: 0.25rem;
        --bs-dropdown-spacer: 0;
        --bs-dropdown-bg: var(--my-dropdown-bg);
        --bs-dropdown-border-color: none;
        --bs-dropdown-border-radius: var(--bs-border-radius-lg);
        --bs-dropdown-link-color: var(--my-heading-color);
        --bs-dropdown-link-hover-color: var(--my-heading-color);
        --bs-dropdown-link-hover-bg: var(--my-dropdown-link-hover-bg);
        --bs-dropdown-link-active-color: var(--my-heading-color);
        --bs-dropdown-link-active-bg: var(--my-dropdown-bg);
        --bs-dropdown-item-padding-x: 1rem;
        --bs-dropdown-item-padding-y: 0.5rem;
        --bs-dropdown-item-border-radius: var(--bs-border-radius);
        box-shadow: 0 0.25rem 1rem rgba(0, 0, 0, 0.175);
      }

      .my-dropdown .dropdown-item {
        display: flex;
        align-items: center;
      }

      .my-dropdown .dropdown-item span {
        margin-inline-end: 2rem;
      }

      .my-dropdown .dropdown-item.active:hover {
        background-color: var(--my-dropdown-link-hover-bg);
      }

      .my-dropdown .dropdown-item:hover:active {
        background-color: var(--my-dropdown-link-hover-bg);
      }

      .my-dropdown .my-dropdown-item-icon {
        margin-inline-end: 0.5rem;
        color: var(--my-alpha-gray-color);
      }

      .my-dropdown .my-dropdown-item-check {
        margin-inline-start: auto;
        color: transparent;
      }

      .my-dropdown .active .my-dropdown-item-check {
        color: var(--my-heading-color);
      }

      .my-btn-primary,
      .my-btn-secondary,
      .my-btn-neutral,
      .my-btn-outline {
        --bs-btn-padding-x: 0.85rem;
        --bs-btn-padding-y: 0.25rem;
        --bs-btn-color: #fff;
        --bs-btn-border-radius: var(--bs-border-radius-lg);
        --bs-btn-hover-color: #fff;
        --bs-btn-active-color: #fff;
        --bs-btn-active-border-color: transparent;
      }

      .my-btn-primary {
        --bs-btn-bg: rgb(25, 125, 225);
        --bs-btn-hover-bg: rgb(0, 110, 210);
        --bs-btn-focus-shadow-rgb: 25, 125, 225;
        --bs-btn-active-bg: rgb(0, 95, 195);
      }

      .my-btn-secondary {
        --bs-btn-color: rgb(25, 125, 225);
        --bs-btn-bg: rgba(25, 125, 225, 0.15);
        --bs-btn-hover-color: rgb(25, 125, 225);
        --bs-btn-hover-bg: rgba(25, 125, 225, 0.2);
        --bs-btn-focus-shadow-rgb: 25, 125, 225;
        --bs-btn-active-color: rgb(25, 125, 225);
        --bs-btn-active-bg: rgba(25, 125, 225, 0.25);
        --bs-btn-active-border-color: transparent;
      }

      .my-btn-neutral {
        --bs-btn-bg: rgb(50, 50, 50);
        --bs-btn-hover-bg: rgb(65, 65, 65);
        --bs-btn-focus-shadow-rgb: var(--my-emphasis-focus-shadow-rgb);
        --bs-btn-active-bg: rgb(75, 75, 75);
        --bs-btn-disabled-color: #fff;
        --bs-btn-disabled-bg: rgb(50, 50, 50);
        --bs-btn-disabled-border-color: transparent;
      }

      .my-btn-outline {
        --bs-btn-color: var(--my-heading-color);
        --bs-btn-bg: transparent;
        --bs-btn-border-color: var(--my-alpha-dark-gray-color);
        --bs-btn-hover-color: var(--my-heading-color);
        --bs-btn-hover-bg: var(--my-gray-color);
        --bs-btn-hover-border-color: var(--my-alpha-dark-gray-color);
        --bs-btn-focus-shadow-rgb: var(--my-emphasis-focus-shadow-rgb);
        --bs-btn-active-color: var(--my-heading-color);
        --bs-btn-active-bg: var(--my-dark-gray-color);
        --bs-btn-active-border-color: var(--my-alpha-dark-gray-color);
      }

      .my-modal {
        --bs-modal-margin: 1rem;
        --bs-modal-bg: var(--my-modal-bg);
        --bs-modal-border-width: 0;
        --bs-modal-border-radius: var(--bs-border-radius-xl);
        --bs-modal-header-padding: 1.5rem 1.5rem 0;
        --bs-modal-header-border-width: 0;
      }

      @media (min-width: 576px) {
        .my-modal {
          --bs-modal-padding: 2rem;
        }
      }

      .my-modal .modal-dialog {
        max-width: 420px;
      }

      .my-modal .modal-content {
        padding-bottom: 1.5rem;
      }

      #qr-code canvas {
        width: 100%;
        max-width: 240px;
        margin-top: 0.5rem;
        border-radius: var(--bs-border-radius-xl);
      }

      @media (max-width: 320px) {
        .my-row-xs > * {
          width: 100%;
        }
      }

      .my-block,
      .my-block-big {
        border-radius: var(--bs-border-radius-xl);
        background-color: var(--my-gray-color);
      }

      .my-block {
        padding: 1rem;
      }

      .my-block .bi {
        font-size: 1.5rem;
      }

      .my-block-big {
        padding: 1.5rem;
        padding-top: 0.75rem;
      }

      .my-text-blue {
        color: #0a85d1;
      }

      .my-text-green {
        color: #1aad3a;
      }

      .my-text-red {
        color: #ea4e43;
      }

      .my-text-yellow {
        color: #fb3;
      }

      .my-text-heading {
        color: var(--my-heading-color);
      }

      .my-text-content {
        color: var(--my-content-color);
      }

      .my-step-counter {
        display: block;
        color: #57b5ef;
        font-weight: 500;
        font-size: 2.5rem;
        -moz-user-select: none;
        -webkit-user-select: none;
        user-select: none;
      }

      .my-step-counter::after {
        content: counter(step-counter);
        counter-increment: step-counter;
      }

      .my-tab-pane {
        counter-reset: step-counter 0;
      }

      /* Переносим длинные названия серверов на мобильных */
      .my-link-separate {
        word-break: break-all;   /* разрешаем разрыв слова на любой позиции */
        white-space: normal;     /* убираем nowrap, чтобы перенос вообще был возможен */
      }

      @media (max-width: 576px) {
        .my-link-separate {
          word-break: break-all;
          white-space: normal;
        }
      }

      /* перенос длинных названий в видимом блоке */
      .my-link-visible{
        word-break: break-word;   /* любой разрыв слова */
        white-space: normal;      /* переносы разрешены */
        padding-right: .5rem;     /* чтобы текст не упирался в кнопку */
      }

      @media (max-width:576px){
        .my-link-visible{font-size:0.9rem;} /* при желании уменьшим кегль */
      }
    </style>
  </head>
  <body>
    <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
      <!-- Icons from https://icons.getbootstrap.com -->
      <symbol id="android" viewBox="0 0 16 16">
        <path
          d="M2.76 3.061a.5.5 0 0 1 .679.2l1.283 2.352A8.9 8.9 0 0 1 8 5a8.9 8.9 0 0 1 3.278.613l1.283-2.352a.5.5 0 1 1 .878.478l-1.252 2.295C14.475 7.266 16 9.477 16 12H0c0-2.523 1.525-4.734 3.813-5.966L2.56 3.74a.5.5 0 0 1 .2-.678ZM5 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2m6 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2"
        />
      </symbol>
      <symbol id="apple" viewBox="0 0 16 16">
        <path
          d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516s1.52.087 2.475-1.258.762-2.391.728-2.43m3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422s1.675-2.789 1.698-2.854-.597-.79-1.254-1.157a3.7 3.7 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56s.625 1.924 1.273 2.796c.576.984 1.34 1.667 1.659 1.899s1.219.386 1.843.067c.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758q.52-1.185.473-1.282"
        />
      </symbol>
      <symbol id="arrow-down-up" viewBox="0 0 16 16">
        <path
          fill-rule="evenodd"
          d="M11.5 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L11 2.707V14.5a.5.5 0 0 0 .5.5m-7-14a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L4 13.293V1.5a.5.5 0 0 1 .5-.5"
        />
      </symbol>
      <symbol id="calendar3" viewBox="0 0 16 16">
        <path
          d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2M1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857z"
        />
        <path
          d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2"
        />
      </symbol>
      <symbol id="check-lg" viewBox="0 0 16 16">
        <path
          d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"
        />
      </symbol>
      <symbol id="circle-half" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 0 8 1zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16" />
      </symbol>
      <symbol id="emoji-frown-fill" viewBox="0 0 16 16">
        <path
          d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5m-2.715 5.933a.5.5 0 0 1-.183-.683A4.5 4.5 0 0 1 8 9.5a4.5 4.5 0 0 1 3.898 2.25.5.5 0 0 1-.866.5A3.5 3.5 0 0 0 8 10.5a3.5 3.5 0 0 0-3.032 1.75.5.5 0 0 1-.683.183M10 8c-.552 0-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5S10.552 8 10 8"
        />
      </symbol>
      <symbol id="emoji-smile-fill" viewBox="0 0 16 16">
        <path
          d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5M4.285 9.567a.5.5 0 0 1 .683.183A3.5 3.5 0 0 0 8 11.5a3.5 3.5 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683M10 8c-.552 0-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5S10.552 8 10 8"
        />
      </symbol>
      <symbol id="moon-stars-fill" viewBox="0 0 16 16">
        <path
          d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278"
        />
        <path
          d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.73 1.73 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.73 1.73 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.73 1.73 0 0 0 1.097-1.097zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.16 1.16 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.16 1.16 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732z"
        />
      </symbol>
      <symbol id="pc-display" viewBox="0 0 16 16">
        <path
          d="M0 4s0-2 2-2h12s2 0 2 2v6s0 2-2 2h-4q0 1 .25 1.5H11a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1h.75Q6 13 6 12H2s-2 0-2-2zm1.398-.855a.76.76 0 0 0-.254.302A1.5 1.5 0 0 0 1 4.01V10c0 .325.078.502.145.602q.105.156.302.254a1.5 1.5 0 0 0 .538.143L2.01 11H14c.325 0 .502-.078.602-.145a.76.76 0 0 0 .254-.302 1.5 1.5 0 0 0 .143-.538L15 9.99V4c0-.325-.078-.502-.145-.602a.76.76 0 0 0-.302-.254A1.5 1.5 0 0 0 13.99 3H2c-.325 0-.502.078-.602.145"
        />
      </symbol>
      <symbol id="person-fill" viewBox="0 0 16 16">
        <path
          d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"
        />
      </symbol>
      <symbol id="sun-fill" viewBox="0 0 16 16">
        <path
          d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708"
        />
      </symbol>
      <symbol id="translate" viewBox="0 0 16 16">
        <path
          d="M4.545 6.714 4.11 8H3l1.862-5h1.284L8 8H6.833l-.435-1.286zm1.634-.736L5.5 3.956h-.049l-.679 2.022z"
        />
        <path
          d="M0 2a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v3h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-3H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zm7.138 9.995q.289.451.63.846c-.748.575-1.673 1.001-2.768 1.292.178.217.451.635.555.867 1.125-.359 2.08-.844 2.886-1.494.777.665 1.739 1.165 2.93 1.472.133-.254.414-.673.629-.89-1.125-.253-2.057-.694-2.82-1.284.681-.747 1.222-1.651 1.621-2.757H14V8h-3v1.047h.765c-.318.844-.74 1.546-1.272 2.13a6 6 0 0 1-.415-.492 2 2 0 0 1-.94.31"
        />
      </symbol>
      <symbol id="qr" viewBox="0 0 16 16">
        <path
          d="M2 0a2 2 0 0 0-2 2v4a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V2a2 2 0 0 0-2-2zm10 0a2 2 0 0 0-2 2v4a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V2a2 2 0 0 0-2-2zM2 10a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2zm4 0a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1zm4 0a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1zm1 4a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1z"
        />
      </symbol>
    </svg>
    <header class="navbar my-navbar navbar-expand-sm pb-5" x-data>
      <div class="container my-container px-3">
        <a class="navbar-brand" href="#">
          <img
            src="https://raw.githubusercontent.com/dermv/marzbanify-template/refs/heads/main/img/logo.png"
            alt="Logo"
            width="32"
            height="32"
          />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbar-collapse-content"
          aria-controls="navbar-collapse-content"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="navbar-collapse collapse mt-2 mt-sm-0"
          id="navbar-collapse-content"
        >
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a
                class="nav-link my-nav-link"
                href="https://t.me/"
                rel="noopener noreferrer"
                target="_blank"
                x-text="$t('support')"
              ></a>
            </li>
            <li class="nav-item dropdown my-dropdown">
              <a
                class="nav-link my-nav-link dropdown-toggle"
                id="btn-theme"
                role="button"
                data-bs-toggle="dropdown"
                tabindex="0"
                aria-expanded="false"
              >
                <svg class="bi my-nav-link-icon">
                  <use href="#circle-half"></use>
                </svg>
                <span class="my-nav-link-text"></span>
              </a>
              <ul class="dropdown-menu">
                <li>
                  <button
                    class="dropdown-item my-dropdown-item-theme active"
                    type="button"
                    data-theme-val="system"
                    aria-pressed="true"
                  >
                    <svg class="bi my-dropdown-item-icon">
                      <use href="#circle-half"></use>
                    </svg>
                    <span x-text="$t('system')"></span>
                    <svg class="bi my-dropdown-item-check">
                      <use href="#check-lg"></use>
                    </svg>
                  </button>
                </li>
                <li>
                  <button
                    class="dropdown-item my-dropdown-item-theme"
                    type="button"
                    data-theme-val="light"
                    aria-pressed="false"
                  >
                    <svg class="bi my-dropdown-item-icon">
                      <use href="#sun-fill"></use>
                    </svg>
                    <span x-text="$t('light')"></span>
                    <svg class="bi my-dropdown-item-check">
                      <use href="#check-lg"></use>
                    </svg>
                  </button>
                </li>
                <li>
                  <button
                    class="dropdown-item my-dropdown-item-theme"
                    type="button"
                    data-theme-val="dark"
                    aria-pressed="false"
                  >
                    <svg class="bi my-dropdown-item-icon">
                      <use href="#moon-stars-fill"></use>
                    </svg>
                    <span x-text="$t('dark')"></span>
                    <svg class="bi my-dropdown-item-check">
                      <use href="#check-lg"></use>
                    </svg>
                  </button>
                </li>
              </ul>
            </li>
            <li class="nav-item dropdown my-dropdown">
              <a
                class="nav-link my-nav-link dropdown-toggle"
                id="btn-lang"
                role="button"
                data-bs-toggle="dropdown"
                tabindex="0"
                aria-expanded="false"
              >
                <svg class="bi"><use href="#translate"></use></svg>
                <span class="my-nav-link-text">English</span>
              </a>
              <ul class="dropdown-menu">
                <li>
                  <button
                    class="dropdown-item my-dropdown-item-lang active"
                    type="button"
                    data-locale="en"
                    aria-pressed="true"
                  >
                    <span>English</span>
                    <svg class="bi my-dropdown-item-check">
                      <use href="#check-lg"></use>
                    </svg>
                  </button>
                </li>
                <li>
                  <button
                    class="dropdown-item my-dropdown-item-lang"
                    type="button"
                    data-locale="ru"
                    aria-pressed="false"
                  >
                    <span>Русский</span>
                    <svg class="bi my-dropdown-item-check">
                      <use href="#check-lg"></use>
                    </svg>
                  </button>
                </li>
                <li>
                  <button
                    class="dropdown-item my-dropdown-item-lang"
                    type="button"
                    data-locale="zh"
                    aria-pressed="false"
                  >
                    <span>中文</span>
                    <svg class="bi my-dropdown-item-check">
                      <use href="#check-lg"></use>
                    </svg>
                  </button>
                </li>
                <li>
                  <button
                    class="dropdown-item my-dropdown-item-lang"
                    type="button"
                    data-locale="fa"
                    aria-pressed="false"
                  >
                    <span>فارسی</span>
                    <svg class="bi my-dropdown-item-check">
                      <use href="#check-lg"></use>
                    </svg>
                  </button>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </header>
    <div class="container my-container px-3 pb-3" x-data>
      <div
        class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3"
      >
        <h4
          class="my-text-heading fw-bold mb-0"
          x-text="$t('subscription')"
        ></h4>
        <button
          class="btn my-btn-outline"
          data-bs-toggle="modal"
          data-bs-target="#get-link-modal"
          x-text="$t('getLink')"
        ></button>
        <div class="modal my-modal fade" id="get-link-modal" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <button
                  type="button"
                  class="btn-close my-btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body text-center" x-data="copyLink">
                <div class="mb-4" id="qr-code"></div>
                <h4
                  class="my-text-heading fw-semibold"
                  x-text="$t('getLinkModalTitle')"
                ></h4>
                <p
                  class="my-text-content"
                  x-text="$t('getLinkModalSubtitle')"
                ></p>
                <button
                  class="btn my-btn-neutral"
                  @click="copyToClipboard"
                  :disabled="isDisabled"
                  x-text="isDisabled ? $t('copied') : $t('copyLink')"
                ></button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row my-row-xs row-cols-2 row-cols-md-4 g-3 mb-5">
        <div class="col">
          <div class="my-block" x-data="blockName">
            <div
              class="d-flex flex-row flex-sm-column align-items-center align-items-sm-start mb-1 mb-sm-0"
            >
              <svg class="bi my-text-blue me-2 mb-0 mb-sm-2">
                <use href="#person-fill"></use>
              </svg>
              <h5 class="my-text-heading mb-0" x-text="$t('name')"></h5>
            </div>
            <p class="text-truncate my-text-content mb-0" x-text="getText"></p>
          </div>
        </div>
        <div class="col">
          <div class="my-block" x-data="blockStatus">
            <div
              class="d-flex flex-row flex-sm-column align-items-center align-items-sm-start mb-1 mb-sm-0"
            >
              <svg class="bi my-text-green me-2 mb-0 mb-sm-2">
                <use :href="getIcon"></use>
              </svg>
              <h5 class="my-text-heading mb-0" x-text="$t('status')"></h5>
            </div>
            <p class="text-truncate my-text-content mb-0" x-text="getText"></p>
          </div>
        </div>
        <div class="col">
          <div class="my-block" x-data="blockDuration">
            <div
              class="d-flex flex-row flex-sm-column align-items-center align-items-sm-start mb-1 mb-sm-0"
            >
              <svg class="bi my-text-red me-2 mb-0 mb-sm-2">
                <use href="#calendar3"></use>
              </svg>
              <h5 class="my-text-heading mb-0" x-text="$t('duration')"></h5>
            </div>
            <p class="text-truncate my-text-content mb-0" x-text="getText"></p>
          </div>
        </div>
        <div class="col">
          <div class="my-block" x-data="blockTraffic">
            <div
              class="d-flex flex-row flex-sm-column align-items-center align-items-sm-start mb-1 mb-sm-0"
            >
              <svg class="bi my-text-yellow me-2 mb-0 mb-sm-2">
                <use href="#arrow-down-up"></use>
              </svg>
              <h5 class="my-text-heading mb-0" x-text="$t('traffic')"></h5>
            </div>
            <p class="text-truncate my-text-content mb-0" x-text="getText"></p>
          </div>
        </div>
      </div>

      {% if user.status.value == 'active' %}
      <div
        class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3"
      >
        <h4
          class="my-text-heading fw-bold mb-0"
          x-text="$t('separateLinksTitle')"
        ></h4>
      </div>
      <div class="my-block-big mb-5">
        <p class="my-text-content mb-2" x-text="$t('separateLinks1')"></p>
        <p class="my-text-content mb-0" x-text="$t('separateLinks2')"></p>

        {% for link in user.links %}
        <div
          class="input-group input-group-lg border border-0 text-bg-dark rounded-4 mb-3"
        >
          <!-- Скрытый инпут: нужен скрипту для data-original-link -->
          <input
              type="text"
              class="d-none my-link-hidden"
              value="{{ link }}"
              readonly
              disabled />

          <!-- Видимый элемент с именем сервера -->
          <span class="form-control my-link-visible ps-4 d-flex align-items-center"
                data-original-link="{{ link }}"></span>

          <button
            class="btn my-btn btn-copy-server fs-5 mt-2 mb-2 rounded-3 pb-2 pt-1"
            data-link="{{ link }}"
          >
            <i class="bi bi-clipboard2-fill"></i>
          </button>
          <button
            class="btn my-btn-secondary m-2 rounded-3 btn-show-qr-server"
            data-bs-toggle="modal"
            data-bs-target="#qr-code-modal"
            data-qr-link="{{ link }}"
          >
            <svg class="bi"><use href="#qr"></use></svg>
          </button>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- QR Modal for Server Links -->
      <div class="modal my-modal fade" id="qr-code-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title my-text-heading" id="qr-modal-title">
                QR код
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body text-center">
              <div id="server-qr-code"></div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3"
      >
        <h4 class="my-text-heading fw-bold mb-0" x-text="$t('guide')"></h4>
        <div class="dropdown my-dropdown">
          <button
            class="nav-link my-nav-outline dropdown-toggle"
            id="btn-guide"
            type="button"
            data-bs-toggle="dropdown"
          >
            <svg class="bi my-nav-link-icon"><use href="#android"></use></svg>
            <span class="my-nav-link-text"></span>
          </button>
          <ul class="dropdown-menu" role="tablist">
            <li>
              <button
                class="dropdown-item my-dropdown-item-guide active"
                id="btn-guide-android-tab"
                type="button"
                data-bs-target="#tab-android"
                data-bs-toggle="tab"
                role="tab"
                aria-controls="tab-android"
                aria-selected="true"
              >
                <svg class="bi my-dropdown-item-icon">
                  <use href="#android"></use>
                </svg>
                <span>Android</span>
                <svg class="bi my-dropdown-item-check">
                  <use href="#check-lg"></use>
                </svg>
              </button>
            </li>
            <li>
              <button
                class="dropdown-item my-dropdown-item-guide"
                id="btn-guide-ios-tab"
                type="button"
                data-bs-target="#tab-ios"
                data-bs-toggle="tab"
                role="tab"
                aria-controls="tab-ios"
                aria-selected="false"
              >
                <svg class="bi my-dropdown-item-icon">
                  <use href="#apple"></use>
                </svg>
                <span>iOS</span>
                <svg class="bi my-dropdown-item-check">
                  <use href="#check-lg"></use>
                </svg>
              </button>
            </li>
            <li>
              <button
                class="dropdown-item my-dropdown-item-guide"
                id="btn-guide-pc-tab"
                type="button"
                data-bs-target="#tab-pc"
                data-bs-toggle="tab"
                role="tab"
                aria-controls="tab-pc"
                aria-selected="false"
              >
                <svg class="bi my-dropdown-item-icon">
                  <use href="#pc-display"></use>
                </svg>
                <span x-text="$t('pc')"></span>
                <svg class="bi my-dropdown-item-check">
                  <use href="#check-lg"></use>
                </svg>
              </button>
            </li>
          </ul>
        </div>
      </div>
      <div class="tab-content" role="tablist">
        <div
          id="tab-android"
          class="tab-pane my-tab-pane fade show active"
          aria-labelledby="btn-guide-android-tab"
          role="tabpanel"
        >
          <!-- Program selector for Android (same options as PC) -->
          <ul class="nav nav-pills mb-3" id="android-app-tabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="android-app-clashverge-tab"
                data-bs-toggle="pill"
                data-bs-target="#android-app-clashverge"
                type="button"
                role="tab"
                aria-selected="true"
                x-text="$t('clashVerge')"
              ></button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="android-app-flclash-tab"
                data-bs-toggle="pill"
                data-bs-target="#android-app-flclash"
                type="button"
                role="tab"
                aria-selected="false"
                x-text="$t('flClash')"
              ></button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="android-app-happ-tab"
                data-bs-toggle="pill"
                data-bs-target="#android-app-happ"
                type="button"
                role="tab"
                aria-selected="false"
                x-text="$t('happAlpha')"
              ></button>
            </li>
          </ul>

          <div class="tab-content" id="android-app-tabsContent">
            <div
              class="tab-pane fade show active"
              id="android-app-clashverge"
              role="tabpanel"
              aria-labelledby="android-app-clashverge-tab"
            >
              <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3">
                <div class="col">
                  <div class="my-block-big h-100">
                    <span class="my-step-counter mb-1"></span>
                    <h5
                      class="my-text-heading fw-semibold"
                      x-text="$t('guideContent.android.first.title')"
                    ></h5>
                    <p
                      class="my-text-content"
                      x-html="$t('guideContent.android.first.text')"
                    ></p>
                    <a
                      class="btn my-btn-secondary"
                      href="https://play.google.com/store/apps/details?id=app.hiddify.com"
                      role="button"
                      rel="noopener noreferrer"
                      target="_blank"
                    >
                      <span
                        x-text="$t('openInApp', {app: 'Google Play'})"
                      ></span>
                    </a>
                  </div>
                </div>
                <div class="col">
                  <div class="my-block-big h-100">
                    <span class="my-step-counter mb-1"></span>
                    <h5
                      class="my-text-heading fw-semibold"
                      x-text="$t('guideContent.android.second.title')"
                    ></h5>
                    <p
                      class="my-text-content"
                      x-html="$t('guideContent.android.second.text')"
                    ></p>
                    <a
                      class="btn my-btn-primary"
                      id="sub-url-android"
                      role="button"
                      rel="noopener noreferrer"
                      target="_blank"
                      x-text="$t('addSubscription')"
                    ></a>
                  </div>
                </div>
                <div class="col">
                  <div class="my-block-big h-100">
                    <span class="my-step-counter mb-1"></span>
                    <h5
                      class="my-text-heading fw-semibold"
                      x-text="$t('guideContent.android.third.title')"
                    ></h5>
                    <p
                      class="my-text-content mb-0"
                      x-html="$t('guideContent.android.third.text')"
                    ></p>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="tab-pane fade"
              id="android-app-flclash"
              role="tabpanel"
              aria-labelledby="android-app-flclash-tab"
            >
              <div
                class="alert alert-secondary"
                role="alert"
                x-text="$t('comingSoon')"
              ></div>
            </div>

            <div
              class="tab-pane fade"
              id="android-app-happ"
              role="tabpanel"
              aria-labelledby="android-app-happ-tab"
            >
              <div
                class="alert alert-secondary"
                role="alert"
                x-text="$t('comingSoon')"
              ></div>
            </div>
          </div>
        </div>
        <div
          id="tab-ios"
          class="tab-pane my-tab-pane fade"
          aria-labelledby="btn-guide-ios-tab"
          role="tabpanel"
        >
          <!-- Program selector for iOS (same options as PC) -->
          <ul class="nav nav-pills mb-3" id="ios-app-tabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="ios-app-clashverge-tab"
                data-bs-toggle="pill"
                data-bs-target="#ios-app-clashverge"
                type="button"
                role="tab"
                aria-selected="true"
                x-text="$t('clashVerge')"
              ></button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="ios-app-flclash-tab"
                data-bs-toggle="pill"
                data-bs-target="#ios-app-flclash"
                type="button"
                role="tab"
                aria-selected="false"
                x-text="$t('flClash')"
              ></button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="ios-app-happ-tab"
                data-bs-toggle="pill"
                data-bs-target="#ios-app-happ"
                type="button"
                role="tab"
                aria-selected="false"
                x-text="$t('happAlpha')"
              ></button>
            </li>
          </ul>

          <div class="tab-content" id="ios-app-tabsContent">
            <div
              class="tab-pane fade show active"
              id="ios-app-clashverge"
              role="tabpanel"
              aria-labelledby="ios-app-clashverge-tab"
            >
              <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3">
                <div class="col">
                  <div class="my-block-big h-100">
                    <span class="my-step-counter mb-1"></span>
                    <h5
                      class="my-text-heading fw-semibold"
                      x-text="$t('guideContent.ios.first.title')"
                    ></h5>
                    <p
                      class="my-text-content"
                      x-html="$t('guideContent.ios.first.text')"
                    ></p>
                    <a
                      class="btn my-btn-secondary"
                      href="https://apps.apple.com/app/hiddify-proxy-vpn/id6596777532"
                      role="button"
                      rel="noopener noreferrer"
                      target="_blank"
                    >
                      <span x-text="$t('openInApp', {app: 'App Store'})"></span>
                    </a>
                  </div>
                </div>
                <div class="col">
                  <div class="my-block-big h-100">
                    <span class="my-step-counter mb-1"></span>
                    <h5
                      class="my-text-heading fw-semibold"
                      x-text="$t('guideContent.ios.second.title')"
                    ></h5>
                    <p
                      class="my-text-content"
                      x-html="$t('guideContent.ios.second.text')"
                    ></p>
                    <a
                      class="btn my-btn-primary"
                      id="sub-url-ios"
                      role="button"
                      rel="noopener noreferrer"
                      target="_blank"
                      x-text="$t('addSubscription')"
                    ></a>
                  </div>
                </div>
                <div class="col">
                  <div class="my-block-big h-100">
                    <span class="my-step-counter mb-1"></span>
                    <h5
                      class="my-text-heading fw-semibold"
                      x-text="$t('guideContent.ios.third.title')"
                    ></h5>
                    <p
                      class="my-text-content mb-0"
                      x-html="$t('guideContent.ios.third.text')"
                    ></p>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="tab-pane fade"
              id="ios-app-flclash"
              role="tabpanel"
              aria-labelledby="ios-app-flclash-tab"
            >
              <div
                class="alert alert-secondary"
                role="alert"
                x-text="$t('comingSoon')"
              ></div>
            </div>

            <div
              class="tab-pane fade"
              id="ios-app-happ"
              role="tabpanel"
              aria-labelledby="ios-app-happ-tab"
            >
              <div
                class="alert alert-secondary"
                role="alert"
                x-text="$t('comingSoon')"
              ></div>
            </div>
          </div>
        </div>
        <div
          id="tab-pc"
          class="tab-pane my-tab-pane fade"
          aria-labelledby="btn-guide-pc-tab"
          role="tabpanel"
        >
          <!-- Program selector for PC -->
          <ul class="nav nav-pills mb-3" id="pc-app-tabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="pc-app-clashverge-tab"
                data-bs-toggle="pill"
                data-bs-target="#pc-app-clashverge"
                type="button"
                role="tab"
                aria-selected="true"
                x-text="$t('clashVerge')"
              >
                <!-- 🔹 -->
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="pc-app-flclash-tab"
                data-bs-toggle="pill"
                data-bs-target="#pc-app-flclash"
                type="button"
                role="tab"
                aria-selected="false"
                x-text="$t('flClash')"
              >
                <!-- 🔹 -->
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="pc-app-happ-tab"
                data-bs-toggle="pill"
                data-bs-target="#pc-app-happ"
                type="button"
                role="tab"
                aria-selected="false"
                x-text="$t('happAlpha')"
              >
                <!-- 🔹 -->
              </button>
            </li>
          </ul>

          <div class="tab-content" id="pc-app-tabsContent">
            <!-- 1. Clash Verge (используем существующие три карточки) -->
            <div
              class="tab-pane fade show active"
              id="pc-app-clashverge"
              role="tabpanel"
              aria-labelledby="pc-app-clashverge-tab"
            >
              <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3">
                <div class="col">
                  <div class="my-block-big h-100">
                    <span class="my-step-counter mb-1"></span>
                    <h5
                      class="my-text-heading fw-semibold"
                      x-text="$t('guideContent.pc.first.title')"
                    ></h5>
                    <p
                      class="my-text-content"
                      x-html="$t('guideContent.pc.first.text')"
                    ></p>
                    <div class="d-flex flex-wrap gap-2">
                      <!-- Install the latest pre-release version, because Hiddify,
                         for some damn reason, stopped updating -->
                      <a
                        class="btn my-btn-secondary"
                        href="https://github.com/hiddify/hiddify-app/releases/download/v2.5.7/Hiddify-Windows-Setup-x64.exe"
                        role="button"
                        rel="noopener noreferrer"
                        target="_blank"
                      >
                        Windows
                      </a>
                      <a
                        class="btn my-btn-secondary"
                        href="https://github.com/hiddify/hiddify-app/releases/download/v2.5.7/Hiddify-MacOS.dmg"
                        role="button"
                        rel="noopener noreferrer"
                        target="_blank"
                      >
                        macOS v10.15+
                      </a>
                      <a
                        class="btn my-btn-secondary"
                        href="https://github.com/hiddify/hiddify-app/releases/download/v2.5.7/Hiddify-Linux-x64.AppImage"
                        role="button"
                        rel="noopener noreferrer"
                        target="_blank"
                      >
                        Linux AppImage
                      </a>
                      <a
                        class="btn my-btn-secondary"
                        href="https://github.com/hiddify/hiddify-app/releases/download/v2.5.7/Hiddify-Debian-x64.deb"
                        role="button"
                        rel="noopener noreferrer"
                        target="_blank"
                      >
                        Linux Deb
                      </a>
                      <a
                        class="btn my-btn-secondary"
                        href="https://github.com/hiddify/hiddify-app/releases/download/v2.5.7/Hiddify-rpm-x64.rpm"
                        role="button"
                        rel="noopener noreferrer"
                        target="_blank"
                      >
                        Linux RPM
                      </a>
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="my-block-big h-100">
                    <span class="my-step-counter mb-1"></span>
                    <h5
                      class="my-text-heading fw-semibold"
                      x-text="$t('guideContent.pc.second.title')"
                    ></h5>
                    <p
                      class="my-text-content"
                      x-html="$t('guideContent.pc.second.text')"
                    ></p>
                    <a
                      class="btn my-btn-primary"
                      id="sub-url-pc"
                      role="button"
                      rel="noopener noreferrer"
                      target="_blank"
                      x-text="$t('addSubscription')"
                    ></a>
                  </div>
                </div>
                <div class="col">
                  <div class="my-block-big h-100">
                    <span class="my-step-counter mb-1"></span>
                    <h5
                      class="my-text-heading fw-semibold"
                      x-text="$t('guideContent.pc.third.title')"
                    ></h5>
                    <p
                      class="my-text-content mb-0"
                      x-html="$t('guideContent.pc.third.text')"
                    ></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- 2. FlClash — пока заглушка -->
            <div
              class="tab-pane fade"
              id="pc-app-flclash"
              role="tabpanel"
              aria-labelledby="pc-app-flclash-tab"
            >
              <div
                class="alert alert-secondary"
                role="alert"
                x-text="$t('comingSoon')"
              ></div>
            </div>

            <!-- 3. Happ (alpha) — пока заглушка -->
            <div
              class="tab-pane fade"
              id="pc-app-happ"
              role="tabpanel"
              aria-labelledby="pc-app-happ-tab"
            >
              <div
                class="alert alert-secondary"
                role="alert"
                x-text="$t('comingSoon')"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs-i18n@2.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
    <script>
      // Extract server name from the link
      function getServerName(link) {
        try {
          if (!link) return null;

          // Try to decode URL first
          const decodedLink = decodeURIComponent(link);

          // Extract from fragment identifier (#Name)
          const fragmentMatch = decodedLink.match(/#(.+)$/);
          if (fragmentMatch) return fragmentMatch[1];

          // For vmess links
          if (decodedLink.startsWith("vmess://")) {
            try {
              const base64Data = decodedLink.replace("vmess://", "");
              const jsonData = atob(base64Data);
              const config = JSON.parse(jsonData);
              if (config.ps) return config.ps;
            } catch (e) {
              console.error("Failed to parse vmess link:", e);
            }
          }

          // For other protocols, at least show the protocol
          const protocolMatch = decodedLink.match(/^([a-z]+):\/\//);
          if (protocolMatch) return protocolMatch[1].toUpperCase() + " сервер";

          return "Сервер";
        } catch (e) {
          console.error("Error extracting server name:", e);
          return "Сервер";
        }
      }

      // Replace links with server names
      function replaceLinksWithNames() {
        console.log("Replacing links with names...");

        // Найдем все поля ввода внутри блока "Список доступных серверов"
        try {
          // Сначала пытаемся найти все поля ввода, которые содержат протокольные ссылки
          const inputs = document.querySelectorAll(
            'input[value^="ss://"], input[value^="vless://"], input[value^="vmess://"], input[value^="trojan://"], input[value^="ssr://"]'
          );

          console.log("Found", inputs.length, "inputs with protocol links");

          if (inputs.length === 0) {
            // Если не нашли, попробуем просто найти все поля с классом my-link-separate
            const myLinkInputs = document.querySelectorAll(".my-link-separate");
            console.log(
              "Found",
              myLinkInputs.length,
              "my-link-separate inputs"
            );

            if (myLinkInputs.length === 0) {
              // Если и это не помогло, попробуем найти все поля ввода в блоках input-group
              const groupInputs =
                document.querySelectorAll(".input-group input");
              console.log(
                "Found",
                groupInputs.length,
                "inputs in input-groups"
              );

              processInputs(groupInputs);
            } else {
              processInputs(myLinkInputs);
            }
          } else {
            processInputs(inputs);
          }
        } catch (e) {
          console.error("Error while replacing links:", e);
        }
      }

      // Функция обработки найденных полей ввода
      function processInputs(inputs) {
        inputs.forEach(function (input) {
          try {
            const link = input.value;
            // Проверяем, похоже ли значение на ссылку протокола
            if (
              link &&
              (link.startsWith("ss://") ||
                link.startsWith("vless://") ||
                link.startsWith("vmess://") ||
                link.startsWith("trojan://") ||
                link.startsWith("ssr://") ||
                link.startsWith("http://") ||
                link.startsWith("https://"))
            ) {
              // Сохраняем оригинальную ссылку ПЕРЕД изменением значения
              input.setAttribute("data-original-link", link);

              const name = getServerName(link);
              if (name) {
                console.log(
                  "Replacing",
                  link.substring(0, 20) + "...",
                  "with",
                  name
                );
                // input.setAttribute('data-original-link', link); // Перенесено выше
                input.value = name; // Теперь меняем значение на имя

                // Найдем соответствующую кнопку копирования и обновим её связь с оригинальной ссылкой
                const parent = input.closest(".input-group");
                if (parent) {
                  const copyButton = parent.querySelector(".btn-copy-server");
                  if (copyButton) {
                    copyButton.setAttribute("data-link", link);
                  }

                  // Найдем кнопку QR-кода и обновим её связь с оригинальной ссылкой
                  const qrButton = parent.querySelector(
                    '[data-bs-target="#qr-code-modal"]'
                  );
                  if (qrButton) {
                    qrButton.setAttribute("data-qr-link", link);
                  }
                }

                const span = parent.querySelector('.my-link-visible');
                if (span) span.textContent = name;
              }
            }
          } catch (e) {
            console.error("Error processing input:", e);
          }
        });
      }

      // --- End Toast Notification Element ---

      // --- Declare instances in a higher scope ---
      let toastInstance = null;
      let serverQrCodeInstance = null;
      let mainQrCodeInstance = null;
      // --- End Declare instances ---

      // Попробуем выполнить замену несколько раз
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize Toast Instance
        const toastCopyLinkElement = document.getElementById("toast-copy-link");
        if (toastCopyLinkElement) {
          toastInstance =
            bootstrap.Toast.getOrCreateInstance(toastCopyLinkElement);
        } else {
          console.error(
            "Toast element #toast-copy-link not found during initialization."
          );
        }

        // Initialize Server QR Code Instance
        const serverQrContainer = document.getElementById("server-qr-code");
        if (serverQrContainer) {
          try {
            serverQrCodeInstance = new QRCode(serverQrContainer, {
              width: 256,
              height: 256,
              colorDark: "#000",
              colorLight: "#fff",
              correctLevel: QRCode.CorrectLevel.L,
            });
            console.log("serverQrCodeInstance initialized successfully.");
          } catch (e) {
            console.error("Failed to initialize serverQrCodeInstance:", e);
          }
        } else {
          console.error(
            "server-qr-code container not found during initialization."
          );
        }

        // Initialize Main QR Code Instance
        const qrContainerMain = document.getElementById("qr-code");
        if (qrContainerMain) {
          try {
            // Check if SUB_URL was rendered correctly
            if (SUB_URL && !SUB_URL.startsWith("{")) {
              mainQrCodeInstance = new QRCode(qrContainerMain, {
                text: SUB_URL,
                width: 256,
                height: 256,
                colorDark: "#000",
                colorLight: "#fff",
                correctLevel: QRCode.CorrectLevel.L,
              });
              console.log("Main QR code initialized successfully.");
            } else {
              console.warn(
                "Main QR code NOT initialized because SUB_URL is invalid:",
                SUB_URL
              );
              // Optionally display a placeholder or error message in qrContainerMain
              qrContainerMain.textContent =
                "Ошибка: URL подписки не определен.";
            }
          } catch (e) {
            console.error("Failed to initialize mainQrCodeInstance:", e);
          }
        } else {
          console.error("qr-code container not found during initialization.");
        }

        // Выполняем замену имен серверов несколько раз для надежности
        replaceLinksWithNames();
        setTimeout(replaceLinksWithNames, 500);
        setTimeout(replaceLinksWithNames, 1000);
        setTimeout(replaceLinksWithNames, 2000);

        // Инициализация кнопки выбора платформы с правильной иконкой и текстом
        const btnGuide = document.getElementById("btn-guide");
        if (btnGuide) {
          const initialTabId = getTabIdByDevice(); // Получаем ID таба в зависимости от устройства
          const initialTab = document.querySelector(
            `.my-dropdown-item-guide[data-bs-target="${initialTabId}"]`
          );

          if (initialTab) {
            // Активируем нужный таб по умолчанию
            bootstrap.Tab.getOrCreateInstance(initialTab).show();

            // Обновляем иконку и текст в кнопке меню
            showActiveDropdownItem(btnGuide, initialTab);

            // Добавляем обработчики для переключения платформы при клике
            document
              .querySelectorAll(".my-dropdown-item-guide")
              .forEach((item) => {
                item.addEventListener("click", () => {
                  showActiveDropdownItem(btnGuide, item);
                });
              });
          }
        }

        // Инициализация URI-схем для быстрого импорта подписок
        for (const [os, url] of Object.entries(SUB_URL_SCHEMES)) {
          const element = document.getElementById(`sub-url-${os}`);
          if (element) {
            element.href = url;
          }
        }

        // QR code for main subscription
        const qrContainer = document.getElementById("qr-code");
        qrContainer.innerHTML = ""; // Очищаем контейнер на всякий случай
        new QRCode(qrContainer, {
          text: SUB_URL,
          width: 256,
          height: 256,
          colorDark: "#000",
          colorLight: "#fff",
          correctLevel: QRCode.CorrectLevel.L,
        });

        // Copy button for main subscription - REMOVING THIS BLOCK as it's handled by Alpine.js
        /*
              const mainCopyBtn = document.querySelector('.btn-copy');
              if (mainCopyBtn) {
                  mainCopyBtn.addEventListener('click', () => {
                      navigator.clipboard.writeText(SUB_URL);
                      mainCopyBtn.innerHTML = '<i class="bi bi-check-lg"></i>';
                      setTimeout(() => {
                           mainCopyBtn.innerHTML = '<i class="bi bi-clipboard2-fill"></i>';
                      }, 1500);
                  });
              } else {
                   console.error("Main copy button '.btn-copy' was incorrectly selected and caused an error. Copying is handled by Alpine (@click).");
              }
              */

        // QR Modal setup
        const qrModal = document.getElementById("qr-code-modal");
        if (qrModal) {
          qrModal.addEventListener("show.bs.modal", (event) => {
            const button = event.relatedTarget;
            const serverLink = button.getAttribute("data-qr-link"); // Get link directly from the button
            const modalTitleElement = document.getElementById("qr-modal-title");
            console.log(
              "QR modal show event. Button:",
              button,
              "Link from data-qr-link:",
              serverLink
            );

            if (!serverLink) {
              console.error("QR button is missing data-qr-link attribute!");
              alert("Не удалось получить ссылку для QR-кода.");
              return;
            }

            if (!serverQrCodeInstance) {
              console.error("serverQrCodeInstance is not initialized!");
              alert("Ошибка инициализации QR-генератора.");
              return;
            }

            if (!modalTitleElement) {
              console.error("modalTitleElement #qr-modal-title not found!");
              // Continue without title if necessary
            }

            // Update modal title
            const name = getServerName(serverLink);
            if (modalTitleElement) {
              modalTitleElement.textContent = name || "QR Code";
            }

            // Generate QR code
            try {
              serverQrCodeInstance.clear();
              serverQrCodeInstance.makeCode(serverLink);
              console.log("QR code generated for:", serverLink);
            } catch (e) {
              console.error("Error generating QR code:", e);
              alert("Не удалось сгенерировать QR-код: " + e.message);
            }
          });
        }

        // Copy server link buttons
        document.querySelectorAll(".btn-copy-server").forEach((button) => {
          button.addEventListener("click", () => {
            let link = null;
            // --- Retrieve link from related input's data-original-link ---
            const parentGroup = button.closest(".input-group");
            if (parentGroup) {
              const relatedInput = parentGroup.querySelector('[data-original-link]');
              if (relatedInput) {
                link = relatedInput.getAttribute("data-original-link");
                console.log(
                  "Copy button: Link retrieved from input data-original-link:",
                  link
                );
              } else {
                console.error(
                  "Copy button: Could not find related input with data-original-link."
                );
              }
            } else {
              console.error(
                "Copy button: Could not find parent .input-group for button."
              );
            }
            // --- End Retrieve link ---

            // console.log('Copy button clicked. Link retrieved:', link);

            if (!link) {
              console.error(
                "Copy button is missing data-link attribute!",
                button
              );
              alert("Не удалось найти ссылку для копирования.");
              return;
            }

            navigator.clipboard
              .writeText(link)
              .then(() => {
                console.log("Server link copied successfully!");
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="bi bi-check-lg"></i>';
                button.disabled = true;

                // Show toast notification
                const toastText = document.getElementById("toast-copy-text");
                let copiedText = "Скопировано";
                if (typeof AlpineI18n !== "undefined" && AlpineI18n.t) {
                  try {
                    copiedText =
                      AlpineI18n.t("copiedToClipboard") || copiedText;
                  } catch (e) {
                    console.warn(
                      "AlpineI18n.t('copiedToClipboard') failed:",
                      e
                    );
                  }
                }
                if (toastText) toastText.textContent = copiedText;

                if (toastInstance) {
                  toastInstance.show();
                } else {
                  console.error("Toast instance is not available.");
                  // Fallback notification if toast fails
                  // alert(copiedText);
                }

                setTimeout(() => {
                  button.innerHTML = originalHTML;
                  button.disabled = false;
                }, 1500);
              })
              .catch((err) => {
                console.error("Failed to copy server link: ", err);
                alert("Не удалось скопировать ссылку: " + err);
              });
          });
        });
      });

      // Define SUB_URL (assuming it comes from Jinja or is the current URL)
      const SUB_URL = "{{ user.subscription_url }}"; // Simpler definition, relies on Marzban providing this variable
      if (!SUB_URL || SUB_URL.startsWith("{")) {
        console.warn(
          "Subscription URL (SUB_URL) might not be defined correctly! Value:",
          SUB_URL
        );
        // Fallback or show error - Using current page URL as a guess
        // const SUB_URL = window.location.href;
        // console.warn('Falling back to window.location.href for SUB_URL');
      }

      // URL schemes for quick subscription import.
      const SUB_URL_SCHEMES = {
        pc: `hiddify://import/${SUB_URL}`,
        android: `hiddify://import/${SUB_URL}`,
        ios: `hiddify://import/${SUB_URL}`,
      };

      // Default locale used to display content if
      // the user's locale is not specified.
      const DEFAULT_LOCALE = "en";
      // Translation data.
      const MESSAGES = {
        en: {
          support: "Support",
          system: "System",
          light: "Light",
          dark: "Dark",
          name: "Name",
          status: "Status",
          active: "Active",
          limited: "Limited",
          expired: "Expired",
          disabled: "Disabled",
          duration: "Duration",
          until: "Until",
          forever: "Forever",
          traffic: "Traffic",
          subscription: "Subscription",
          getLink: "Get link",
          getLinkModalTitle: "Scan the QR code above in the client",
          getLinkModalSubtitle:
            "Simple subscription addition in any client. Another option: copy the link below and paste it into the client",
          copyLink: "Copy link",
          copied: "Copied",
          guide: "Guide",
          pc: "PC",
          openInApp: "Open in {app}",
          addSubscription: "Add subscription",
          clashVerge: "⭐ Hiddify",
          flClash: "FlClash",
          happAlpha: "Happ (alpha)",
          comingSoon: "Coming soon…",
          separateLinksTitle: "Available Servers List",
          separateLinks1:
            "In this section, you can access your configurations individually, which allows you to share each of them using a QR code or simply copy them",
          separateLinks2:
            "May be useful if, for example, you need to set up a connection only to a specific server on a particular device",
          guideContent: {
            android: {
              first: {
                title: "Install and open Hiddify",
                text: "Open the page in Google Play and install the app. Launch it, select the <b>Russia</b> region, and then press <b>Start</b>.",
              },
              second: {
                title: "Add the subscription",
                text: "Press the button below — the app will open, and the subscription will be added automatically.",
              },
              third: {
                title: "Connect and enjoy",
                text: "In the main section, press the large power button in the center to connect to the VPN. If needed, select another server by tapping on the «>» icon at the bottom. Enjoy :)",
              },
            },
            ios: {
              first: {
                title: "Install and open Hiddify",
                text: "Open the page in App Store and install the app. Launch it, tap <b>Allow</b> in the VPN configuration permission window, and enter your passcode. Select the <b>Russia</b> region, and then press <b>Start</b>.",
              },
              second: {
                title: "Add the subscription",
                text: "Press the button below and in the pop-up window press <b>Open</b> — the app will open, and the subscription will be added automatically.",
              },
              third: {
                title: "Connect and enjoy",
                text: "In the main section, press the large power button in the center to connect to the VPN. If needed, select another server by tapping on the «>» icon at the bottom. Enjoy :)",
              },
            },
            pc: {
              first: {
                title: "Install and open Hiddify",
                text: "Install the app. Launch it, select the <b>Russia</b> region, and then press <b>Start</b>.",
              },
              second: {
                title: "Add the subscription",
                text: "Press the button below — the app will open, and the subscription will be added automatically. If this doesn't happen, close the app and try again.",
              },
              third: {
                title: "Connect and enjoy",
                text: "In the main section, press the large power button in the center to connect to the VPN. If needed, select another server in the <b>Proxy</b> section. Enjoy :)",
              },
            },
          },
        },
        ru: {
          support: "Поддержка",
          system: "Системная",
          light: "Светлая",
          dark: "Темная",
          name: "Имя",
          status: "Статус",
          active: "Активна",
          limited: "Ограничена",
          expired: "Истекла",
          disabled: "Отключена",
          duration: "Срок",
          until: "До",
          forever: "Навсегда",
          traffic: "Трафик",
          subscription: "Подписка",
          getLink: "Получить ссылку",
          getLinkModalTitle: "Отсканируй QR-код выше в клиенте",
          getLinkModalSubtitle:
            "Простое добавление подписки в любой клиент. Есть и другой вариант: скопируй ссылку ниже и вставь в клиент",
          copyLink: "Скопировать ссылку",
          copied: "Скопировано",
          guide: "Инструкция",
          pc: "ПК",
          openInApp: "Открыть в {app}",
          addSubscription: "Добавить подписку",
          clashVerge: "⭐ Hiddify",
          flClash: "FlClash",
          happAlpha: "Happ (alpha)",
          comingSoon: "Coming soon…",
          separateLinksTitle: "Список доступных серверов",
          separateLinks1:
            "В этом разделе вы получаете доступ к своим конфигурациям по отдельности, что позволяет делиться каждой из них с помощью QR-кода или просто копировать их",
          separateLinks2:
            "Может пригодиться, если, например, нужно настроить подключение только к конкретному серверу на определенном устройстве",
          guideContent: {
            android: {
              first: {
                title: "Установи и открой Hiddify",
                text: "Открой страницу в Google Play и установи приложение. Запусти его, выбери регион <b>Россия</b>, а затем нажми <b>Старт</b>.",
              },
              second: {
                title: "Добавь подписку",
                text: "Нажми кнопку ниже — приложение откроется, и подписка добавится автоматически.",
              },
              third: {
                title: "Подключись и пользуйся",
                text: "В главном разделе нажми большую кнопку включения в центре для подключения к VPN. При необходимости выбери другой сервер, нажав на «>» внизу. Пользуйся :)",
              },
            },
            ios: {
              first: {
                title: "Установи и открой Hiddify",
                text: "Открой страницу в App Store и установи приложение. Запусти его, в окне разрешения на добавление конфигураций VPN нажми <b>Разрешить</b> и введи свой код-пароль. Выбери регион <b>Россия</b>, а затем нажми <b>Старт</b>.",
              },
              second: {
                title: "Добавь подписку",
                text: "Нажми на кнопку ниже и в появившемся окне нажми <b>Открыть</b> — откроется приложение, и подписка добавится автоматически.",
              },
              third: {
                title: "Подключись и пользуйся",
                text: "В главном разделе нажми большую кнопку включения в центре для подключения к VPN. При необходимости выбери другой сервер, нажав на «>» внизу. Пользуйся :)",
              },
            },
            pc: {
              first: {
                title: "Установи и открой Hiddify",
                text: "Установи приложение. Запусти его, выбери регион <b>Россия</b>, а затем нажми <b>Старт</b>.",
              },
              second: {
                title: "Добавь подписку",
                text: "Нажми кнопку ниже — приложение откроется, и подписка добавится автоматически. Если это не произошло, закрой приложение и попробуй снова.",
              },
              third: {
                title: "Подключись и пользуйся",
                text: "В главном разделе нажми большую кнопку включения в центре для подключения к VPN. При необходимости выбери другой сервер в разделе <b>Прокси</b>. Пользуйся :)",
              },
            },
          },
        },
        zh: {
          support: "支持",
          system: "系统",
          light: "浅色",
          dark: "深色",
          name: "名字",
          status: "状态",
          active: "激活",
          limited: "受限",
          expired: "已过期",
          disabled: "已禁用",
          duration: "持续时间",
          until: "直到",
          forever: "永久",
          traffic: "流量",
          subscription: "订阅",
          getLink: "获取链接",
          getLinkModalTitle: "在客户端扫描上方二维码",
          getLinkModalSubtitle:
            "简单地在任何客户端添加订阅。还有另一种方法：复制下面的链接并粘贴到客户端中。",
          copyLink: "复制链接",
          copied: "已复制",
          guide: "指南",
          pc: "电脑",
          openInApp: "在 {app} 中打开",
          addSubscription: "添加订阅",
          clashVerge: "⭐ Hiddify",
          flClash: "FlClash",
          happAlpha: "Happ (alpha)",
          comingSoon: "Coming soon…",
          separateLinksTitle: "可用服务器列表",
          separateLinks1:
            "在此部分中，您可以单独访问您的配置，这允许您使用QR码共享它们或简单地复制它们",
          separateLinks2:
            "如果您需要在特定设备上仅连接到特定服务器，这可能会很有用",
          guideContent: {
            android: {
              first: {
                title: "安装并打开 Hiddify",
                text: `在 Google Play 页面打开并安装应用程序。启动应用，选择区域 <b>俄罗斯</b>，然后点击 <b>开始</b>。`,
              },
              second: {
                title: "添加订阅",
                text: `点击下方按钮 — 应用程序将打开并自动添加订阅。如果未成功，请关闭应用程序并重试。`,
              },
              third: {
                title: "连接并享受",
                text: `在主界面点击中心的大开关按钮以连接到 VPN。如有需要，可以通过点击底部的「>」图标选择其他服务器。尽情享受 :)`,
              },
            },
            ios: {
              first: {
                title: "安装并打开 Hiddify",
                text: `在 App Store 页面打开并安装应用程序。启动后，在 VPN 配置权限窗口点击 <b>允许</b>，然后输入您的密码。选择区域 <b>俄罗斯</b>，然后点击 <b>开始</b>。`,
              },
              second: {
                title: "添加订阅",
                text: `点击下方按钮，在弹出窗口中点击 <b>打开</b> — 应用程序将打开并自动添加订阅。如果未成功，请关闭应用程序并重试。`,
              },
              third: {
                title: "连接并享受",
                text: `在主界面点击中心的大开关按钮以连接到 VPN。如有需要，可以通过点击底部的「>」图标选择其他服务器。尽情享受 :)`,
              },
            },
            pc: {
              first: {
                title: "安装并打开 Hiddify",
                text: `安装应用程序。启动应用，选择区域 <b>俄罗斯</b>，然后点击 <b>开始</b>。`,
              },
              second: {
                title: "添加订阅",
                text: `点击下方按钮 — 应用程序将打开并自动添加订阅。如果未成功，请关闭应用程序并重试。`,
              },
              third: {
                title: "连接并享受",
                text: `在主界面点击中心的大开关按钮以连接到 VPN。如有需要，可以在<b>代理</b>部分选择其他服务器。尽情享受 :)`,
              },
            },
          },
        },
        fa: {
          support: "پشتیبانی",
          system: "سیستم",
          light: "روشن",
          dark: "تاریک",
          name: "نام",
          status: "وضعیت",
          active: "فعال",
          limited: "محدود",
          expired: "منقضی‌شده",
          disabled: "غیرفعال",
          duration: "مدت زمان",
          until: "تا",
          forever: "برای همیشه",
          traffic: "ترافیک",
          subscription: "اشتراک",
          getLink: "دریافت لینک",
          getLinkModalTitle: "کد QR بالا را در برنامه اسکن کنید",
          getLinkModalSubtitle:
            "افزودن اشتراک به سادگی در هر برنامه‌ای. گزینه دیگر: لینک زیر را کپی کرده و در برنامه جای‌گذاری کنید",
          copyLink: "کپی لینک",
          copied: "کپی شد",
          guide: "راهنما",
          pc: "کامپیوتر",
          openInApp: "باز کردن در {app}",
          addSubscription: "افزودن اشتراک",
          clashVerge: "⭐ Hiddify",
          flClash: "FlClash",
          happAlpha: "Happ (alpha)",
          comingSoon: "Coming soon…",
          separateLinksTitle: "لیست سرورهای موجود",
          separateLinks1:
            "در این بخش، شما می‌توانید به پیکربندی‌های خود به صورت جداگانه دسترسی داشته باشید که به شما امکان می‌دهد هر یک از آنها را با استفاده از کد QR به اشتراک بگذارید یا به سادگی آنها را کپی کنید",
          separateLinks2:
            "ممکن است مفید باشد اگر، به عنوان مثال، نیاز به راه‌اندازی اتصال تنها به یک سرور خاص در یک دستگاه خاص داشته باشید",
          guideContent: {
            android: {
              first: {
                title: "نصب و باز کردن Hiddify",
                text: "صفحه را در گوگل پلی باز کرده و برنامه را نصب کنید. آن را اجرا کنید، منطقه <b>روسیه</b> را انتخاب کرده و سپس روی <b>شروع</b> کلیک کنید.",
              },
              second: {
                title: "افزودن اشتراک",
                text: "روی دکمه زیر کلیک کنید — برنامه باز می‌شود و اشتراک به‌طور خودکار اضافه می‌شود.",
              },
              third: {
                title: "اتصال و لذت بردن",
                text: "در بخش اصلی، روی دکمه بزرگ روشن/خاموش در مرکز کلیک کنید تا به VPN متصل شوید. در صورت نیاز، با ضربه زدن روی نماد «>» در پایین، سرور دیگری را انتخاب کنید. لذت ببرید :)",
              },
            },
            ios: {
              first: {
                title: "نصب و باز کردن Hiddify",
                text: "صفحه را در اپ استور باز کرده و برنامه را نصب کنید. آن را اجرا کنید، در پنجره مجوز پیکربندی VPN روی <b>اجازه دادن</b> کلیک کنید و گذرواژه خود را وارد کنید. منطقه <b>روسیه</b> را انتخاب کرده و سپس روی <b>شروع</b> کلیک کنید.",
              },
              second: {
                title: "افزودن اشتراک",
                text: "روی دکمه زیر کلیک کنید و در پنجره پاپ‌آپ روی <b>باز کردن</b> کلیک کنید — برنامه باز می‌شود و اشتراک به‌طور خودکار اضافه می‌شود.",
              },
              third: {
                title: "اتصال و لذت بردن",
                text: "در بخش اصلی، روی دکمه بزرگ روشن/خاموش در مرکز کلیک کنید تا به VPN متصل شوید. در صورت نیاز، با ضربه زدن روی نماد «>» در پایین، سرور دیگری را انتخاب کنید. لذت ببرید :)",
              },
            },
            pc: {
              first: {
                title: "نصب و باز کردن Hiddify",
                text: "برنامه را نصب کنید. آن را اجرا کنید، منطقه <b>روسیه</b> را انتخاب کرده و سپس روی <b>شروع</b> کلیک کنید.",
              },
              second: {
                title: "افزودن اشتراک",
                text: "روی دکمه زیر کلیک کنید — برنامه باز می‌شود و اشتراک به‌طور خودکار اضافه می‌شود. اگر این اتفاق نیفتاد، برنامه را ببندید و دوباره امتحان کنید.",
              },
              third: {
                title: "اتصال و لذت بردن",
                text: "در بخش اصلی، روی دکمه بزرگ روشن/خاموش در مرکز کلیک کنید تا به VPN متصل شوید. در صورت نیاز، در بخش <b>پروکسی</b> سرور دیگری را انتخاب کنید. لذت ببرید :)",
              },
            },
          },
        },
      };

      function updateDirectionAndStyles(language) {
        const html = document.documentElement;
        if (["ar", "he", "fa"].includes(language)) {
          html.setAttribute("dir", "rtl");
          switchStylesheet(
            "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css"
          );
        } else {
          html.setAttribute("dir", "ltr");
          switchStylesheet(
            "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          );
        }
      }

      function switchStylesheet(newStylesheetHref, newIntegrity) {
        const existingLink = document.getElementById("dynamic-stylesheet");
        if (existingLink) {
          existingLink.href = newStylesheetHref;
        } else {
          const link = document.createElement("link");
          link.rel = "stylesheet";
          link.id = "dynamic-stylesheet";
          link.href = newStylesheetHref;
          link.crossOrigin = "anonymous";
          document.head.appendChild(link);
        }
      }

      function getUserLocale() {
        const userLocale =
          localStorage.getItem("locale") ||
          (navigator.language || navigator.userLanguage).split("-")[0];
        return userLocale in MESSAGES ? userLocale : DEFAULT_LOCALE;
      }

      function getTabIdByDevice() {
        const userAgent = navigator.userAgent.toLowerCase();
        if (userAgent.includes("android")) {
          return "#tab-android";
        } else if (userAgent.includes("iphone") || userAgent.includes("ipad")) {
          return "#tab-ios";
        } else {
          return "#tab-pc";
        }
      }

      function showActiveDropdownItem(btn, newItem, prevItem) {
        if (prevItem) {
          bootstrap.Button.getOrCreateInstance(prevItem).toggle();
          bootstrap.Button.getOrCreateInstance(newItem).toggle();
        }

        const btnIcon = btn.querySelector(".my-nav-link-icon use");
        const newItemIcon = newItem.querySelector(".my-dropdown-item-icon use");
        if (btnIcon && newItemIcon) {
          btnIcon.setAttribute("href", newItemIcon.getAttribute("href"));
        }

        const btnText = btn.querySelector(".my-nav-link-text");
        const newItemText = newItem.querySelector("span");
        if (btnText && newItemText) {
          btnText.innerHTML = newItemText.outerHTML;
        }
      }

      document.addEventListener("alpine-i18n:ready", () => {
        window.AlpineI18n.fallbackLocale = "en";
        window.AlpineI18n.create(getUserLocale(), MESSAGES);
        document.documentElement.setAttribute("lang", getUserLocale());
        updateDirectionAndStyles(getUserLocale());

        const btnLang = document.getElementById("btn-lang");
        document.querySelectorAll(".my-dropdown-item-lang").forEach((item) => {
          item.addEventListener("click", () => {
            localStorage.setItem("locale", item.dataset.locale);
            AlpineI18n.locale = item.dataset.locale;
            updateDirectionAndStyles(item.dataset.locale);
            document.documentElement.setAttribute("lang", item.dataset.locale);
            showActiveDropdownItem(
              btnLang,
              item,
              document.querySelector(".my-dropdown-item-lang.active")
            );
          });
        });

        showActiveDropdownItem(
          btnLang,
          document.querySelector(`[data-locale="${getUserLocale()}"]`),
          document.querySelector(".my-dropdown-item-lang.active")
        );
      });

      document.addEventListener("alpine:init", () => {
        Alpine.data("copyLink", () => ({
          isDisabled: false,
          copyToClipboard() {
            navigator.clipboard.writeText(SUB_URL);
            this.isDisabled = true;
            setTimeout(() => {
              this.isDisabled = false;
            }, 3000);
          },
        }));

        Alpine.data("blockName", () => ({
          username: "{{ user.username }}",
          getText() {
            if (!this.username.startsWith("{")) {
              return this.username;
            } else {
              return "Unknown";
            }
          },
        }));

        Alpine.data("blockStatus", () => ({
          statusValue: "{{ user.status.value }}",
          getIcon() {
            if (
              this.statusValue == "active" ||
              this.statusValue.startsWith("{")
            ) {
              return "#emoji-smile-fill";
            } else {
              return "#emoji-frown-fill";
            }
          },
          getText() {
            if (this.statusValue == "active") {
              return AlpineI18n.t("active");
            } else if (this.statusValue == "limited") {
              return AlpineI18n.t("limited");
            } else if (this.statusValue == "expired") {
              return AlpineI18n.t("expired");
            } else if (this.statusValue == "disabled") {
              return AlpineI18n.t("disabled");
            } else if (this.statusValue.startsWith("{")) {
              return "Unknown";
            }
          },
        }));

        Alpine.data("blockDuration", () => ({
          expire: "{% if user.expire %}{{ user.expire | datetime }}{% endif %}",
          getText() {
            if (!this.expire) {
              return AlpineI18n.t("forever");
            } else if (!this.expire.startsWith("{")) {
              const date = new Date(this.expire).toLocaleDateString();
              return `${AlpineI18n.t("until")} ${date}`;
            } else {
              return "Unknown";
            }
          },
        }));

        Alpine.data("blockTraffic", () => ({
          usedTraffic: "{{ user.used_traffic | bytesformat }}",
          dataLimit:
            "{% if user.data_limit %}{{ user.data_limit | bytesformat }}{% endif %}",
          getText() {
            if (!this.dataLimit) {
              return `${this.usedTraffic} / ∞`;
            } else if (!this.dataLimit.startsWith("{")) {
              return `${this.usedTraffic} / ${this.dataLimit}`;
            } else {
              return "Unknown";
            }
          },
        }));
      });
    </script>
  </body>
</html>
